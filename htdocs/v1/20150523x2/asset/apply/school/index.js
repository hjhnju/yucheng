define("apply/school/index",["require","jquery","apply/common/applyCommon","common/ui/Form/selectBox","common/util","common/Remoter"],function(require){function e(e,n){h=r.init(e,n),t()}function t(){function e(e,t,n){var i=e.parent(),r=i.find(".input-icon"),o=i.find(".input-error"),n=e.find("select").attr("data-text");if(!t)r.addClass("error"),o.html(n+"不能为空");else r.attr("class","input-icon fl"),o.html("")}function t(e){var t=e.parent().parent(),n=t.attr("weight");t.remove(),m.total=m.total-Number(n),i(".stock-total").html(m.total),c.errorbox.html("")}i(".loan .form-inpt input").on({focus:function(){var e=i(this).parent().parent(),t=e.find(".input-icon"),n=e.find(".input-error");t.attr("class","input-icon fl"),n.html("")},blur:function(){var e=i(this).parent().parent(),t=i.trim(i(this).val()),n=i(this).attr("data-text"),r=e.find(".input-icon"),o=e.find(".input-error");if(!t)r.addClass("error"),o.html(n+"不能为空")}}),i(".loan .stock-input input").on({focus:function(){c.errorbox.html("")},blur:function(){var e=i.trim(i(this).val()),t=i(this).attr("data-text"),n=i(this).attr("name");if(!e)c.errorbox.html(t+"不能为空");else if("address"==n)p.address.addClass("success"),c.address.html("")}}),u.total_student.blur(function(){var e=i.trim(i(this).val());if(!d.test(e))return p.total_student.addClass("error"),void c.total_student.html(u.total_student.attr("data-text")+"必须位数字！");else return p.total_student.addClass("success"),void c.total_student.html("")}),u.staff.blur(function(){var e=i.trim(i(this).val());if(!d.test(e))return p.staff.addClass("error"),void c.staff.html(u.staff.attr("data-text")+"必须位数字！");else return p.staff.addClass("success"),void c.staff.html("")}),u.branch_school.blur(function(){var e=i.trim(i(this).val());if(!d.test(e))return p.branch_school.addClass("error"),void c.branch_school.html(u.branch_school.attr("data-text")+"必须位数字！");else return p.branch_school.addClass("success"),void c.branch_school.html("")});var r={className:"select_body",optionColor:"#4fc501",selectedColor:"#4fc501",disabled:!1,selectText:"",onSelect:function(t,n,i){e(t,n,i)}};i(".loan .form-inpt select").selectBox(r),i(".loan .add-stock").click(o.debounce(function(e){e.preventDefault();for(var r in f){var o=f[r];if(!o.val())return void c.errorbox.html(o.attr("data-text")+"不能为空")}m=n();var s={name:f.name.val(),weight:f.weight.val()};if(s.weight<20)return void c.errorbox.html("只需要填写占有股份20%以上的股东呦");var a=m.total;if(a+=Number(s.weight),a>100)return void c.errorbox.html("再添加股份超过100%啦");m.total=a;var l="<tr weight="+s.weight+"><td>"+s.name+'</td><td class="tr"><span class="weight">'+s.weight+'</span> %</td><td class="tc"><i class="iconfont icon-delete2 del-stock"></i></td></tr>';i(l).appendTo(".stock-list"),i(".stock-total").html(m.total),i(".loan .del-stock").unbind("click").click(function(){t(i(this))})},1e3)),i(".loan .del-stock").unbind("click").click(function(){t(i(this))}),i(".loan .loan-submit").click(o.debounce(function(e){e.preventDefault();for(var t in u){var i=u[t];if(!i.val())return p[t].addClass("error"),void c[t].html(i.attr("data-text")+"不能为空！")}for(var t in l){var i=l[t];if(!i.val())return p[t].addClass("error"),void c[t].html("不能为空！")}m=n(),a.remote({refer:"1"==o.getUrlParam("refer")?"/apply/review":"",address:u.address.val(),total_student:u.total_student.val(),staff:u.staff.val(),branch_school:u.branch_school.val(),guarantee_count:l.guarantee_count.val(),purpose:l.purpose.val(),stock:m.stock})},1e3))}function n(){var e={stock:[],total:0};return i(".stock-list tr").each(function(){var t={name:i(this).find("td:eq(0)").text(),weight:i(this).find("td:eq(1)").find(".weight").text()};e.stock.push(t),e.total=e.total+Number(t.weight)}),e}var i=require("jquery"),r=require("apply/common/applyCommon");require("common/ui/Form/selectBox");var o=require("common/util"),s=require("common/Remoter"),a=new s("APPLY_SCHOOL_SUBMIT"),l={purpose:i("#select-purpose"),guarantee_count:i("#select-guarantee_count")},u={address:i("[name='address']"),total_student:i("[name='total_student']"),staff:i("[name='staff']"),branch_school:i("[name='branch_school']")},f={name:i("[name='name']"),weight:i("[name='weight']")},c={errorbox:i("#error-box"),purpose:i("#purpose-error"),guarantee_count:i("#guarantee_count-error"),address:i("#address-error"),total_student:i("#total_student-error"),staff:i("#staff-error"),branch_school:i("#branch_school-error")},p={purpose:i("#purpose-icon"),guarantee_count:i("#guarantee_count-icon"),address:i("#address-icon"),total_student:i("#total_student-icon"),staff:i("#staff-icon"),branch_school:i("#branch_school-icon")},d=/^\d+$/,h={},m={stock:[],total:0};return{init:e}});