define("setting/regist/index",["require","jquery","../common/picScroll","common/header","common/ui/Dialog/Dialog","etpl","./regist.tpl","common/Remoter"],function(require){function e(e){n=e?1:0,s.init(),t.init(),l.init(),r(),i()}function r(){o(".regist .login-input").on({focus:function(){var e=o(this).parent(),r=e.children(".username-error");e.removeClass("current"),r.html(""),o(this).next().addClass("hidden")},blur:function(){var e=o(this).parent(),r=o.trim(o(this).val()),i=o(this).attr("data-text"),n=o(this).attr("id");if(!r){if(!o(this).hasClass("login-tuijian"))e.addClass("current"),o("#"+n+"-error").html(i+"不能为空");o(this).next().removeClass("hidden")}}}),C.loginUser.blur(function(){var e=o.trim(o(this).val());if(e)c.remote({name:e});else w.user=0}),C.loginPwd.blur(function(){var e=o.trim(o(this).val());if(!e)return void(w.pwd=0);if(!p.test(e))return w.pwd=0,o(this).parent().addClass("current"),void E.pwdError.html("密码只能为 6 - 32 位数字，字母及常用符号组成");else return w.pwd=1,void E.pwdError.html(v)}),C.loginPhone.blur(function(){var e=o.trim(o(this).val());if(e)g.remote({phone:e});else w.phone=0,o(".login-username-testing").addClass("disabled")}),C.loginTest.blur(function(){var e=o.trim(o(this).val()),r=o.trim(C.loginPhone.val());if(!r)return C.loginPhone.trigger("blur"),void(w.vericode=0);if(e)f.remote({vericode:e,phone:r,type:1});else w.vericode=0}),o(".login-username-testing").click(function(e){e.preventDefault();var r=o.trim(C.loginPhone.val());if(!o(this).hasClass("disabled")&&r)d.remote({phone:r,type:1})}),C.loginTuiJian.blur(function(){var e=o.trim(o(this).val());if(e)m.remote({inviter:e})}),o(".regist .login-fastlogin").click(function(e){e.preventDefault();var r=1;if(!o("#tiaoyue-itp")[0].checked)return void alert("请同意用户条约");for(var i in w)if(w.hasOwnProperty(i))if(!w[i])C[I[i]].trigger("blur"),r=0;r&&h.remote({name:C.loginUser.val(),passwd:C.loginPwd.val(),phone:C.loginPhone.val(),inviter:C.loginTuiJian.val(),vericode:C.loginTest.val(),isthird:n})})}function i(){var e;c.on("success",function(e){if(e&&e.bizError)C.loginUser.parent().addClass("current"),E.userError.html(e.statusInfo),w.user=0;else E.userError.html(v),w.user=1}),g.on("success",function(e){if(e&&e.bizError)C.loginPhone.parent().addClass("current"),E.phoneError.html(e.statusInfo),w.phone=0,o(".login-username-testing").addClass("disabled");else E.phoneError.html(v),w.phone=1,o(".login-username-testing").removeClass("disabled")}),m.on("success",function(e){if(e&&e.bizError)C.loginTuiJian.parent().addClass("current"),E.tuiJianError.html(e.statusInfo),w.tui=0;else E.tuiJianError.html(v),w.tui=1}),d.on("success",function(r){var i=60;if(r&&r.bizError)alert(r.statusInfo);else{var n=o("#testing-wait");n.text("60秒后重新发送"),n.addClass("show"),e=setInterval(function(){if(n.text(--i+"秒后重新发送"),0>i)clearInterval(e),n.removeClass("show")},1e3)}}),f.on("success",function(e){if(e&&e.bizError)C.loginTest.parent().addClass("current"),E.testError.html(e.statusInfo),w.vericode=0;else E.testError.html(v),w.vericode=1}),h.on("success",function(e){if(e&&e.bizError)alert(e.statusInfo);else window.location.href="/user/open/index"}),o(".fix-box-register").click(function(){l.show({width:500,defaultTitle:!1,content:a.render("fixBox")})})}var n,o=require("jquery"),t=require("../common/picScroll"),s=require("common/header"),l=require("common/ui/Dialog/Dialog"),a=require("etpl"),u=(require("./regist.tpl"),require("common/Remoter")),c=new u("REGIST_CHECKNAME_CHECK"),g=new u("REGIST_CHECKPHONE_CHECK"),d=new u("REGIST_SENDSMSCODE_CHECK"),m=new u("REGIST_CHECKINVITER_CHECK"),f=new u("REGIST_CHECKSMSCODE_CHECK"),h=new u("REGIST_INDEX_CHECK"),p=/^[a-zA-Z0-9!@#$%^&'\(\({}=+\-]{6,20}$/,v='<span class="username-error-span"></span>',C={loginUser:o("#regist-user"),loginPwd:o("#regist-pwd"),loginPhone:o("#regist-phone"),loginTest:o("#regist-testing"),loginTuiJian:o("#regist-tuijian")},E={userError:o("#regist-user-error"),phoneError:o("#regist-phone-error"),pwdError:o("#regist-pwd-error"),testError:o("#regist-testing-error"),tuiJianError:o("#regist-tuijian-error")},w={user:0,phone:0,pwd:0,vericode:0,tui:1},I={user:"loginUser",phone:"loginPhone",pwd:"loginPwd",vericode:"loginTest",tui:"loginTuiJian"};return{init:e}});