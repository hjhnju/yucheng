/*! 2014 Baidu Inc. All Rights Reserved */
define("setting/regist/index",function(require){function r(){o.init(),i.init(),e(),n()}function e(){t(".regist .login-input").on({focus:function(){var r=t(this).parent(),e=r.children(".username-error");r.removeClass("current"),e.html(""),t(this).next().addClass("hidden")},blur:function(){var r=t(this).parent(),e=t.trim(t(this).val()),n=t(this).attr("data-text"),i=t(this).attr("id");if(!e){if(!t(this).hasClass("login-tuijian"))r.addClass("current"),t("#"+i+"-error").html(n+"不能为空");t(this).next().removeClass("hidden")}}}),m.loginUser.blur(function(){var r=t.trim(t(this).val());if(r)l.remote({name:r});else p.user=0}),m.loginPwd.blur(function(){var r=t.trim(t(this).val());if(!r)return void(p.pwd=0);if(!d.test(r))return p.pwd=0,t(this).parent().addClass("current"),void v.pwdError.html("密码只能为 6 - 32 位数字，字母及常用符号组成");else return void v.pwdError.html(h)}),m.loginPhone.blur(function(){var r=t.trim(t(this).val());if(r)a.remote({phone:r});else p.phone=0}),m.loginTest.blur(function(){var r=t.trim(t(this).val()),e=t.trim(m.loginPhone.val());if(!e)return m.loginPhone.trigger("blur"),void(p.test=0);if(r)f.remote({vericode:r,phone:e,type:1});else p.test=0}),t(".login-username-testing").click(function(r){r.preventDefault();var e=t.trim(m.loginPhone.val());if(e)u.remote({phone:e})}),m.loginTuiJian.blur(function(){var r=t.trim(t(this).val());if(r)c.remote({inviter:r})}),t(".regist .login-fastlogin").click(function(r){r.preventDefault();var e=1;if(!t("#tiaoyue-itp")[0].checked)return void alert("请同意用户条约");for(var n in p)if(p.hasOwnProperty(n))if(!p[n])m[E[n]].trigger("blur"),e=0;e&&g.remote({name:m.loginUser.val(),passwd:m.loginPwd.val(),phone:m.loginPhone.val(),inviter:m.loginTuiJian.val()})})}function n(){var r;l.on("success",function(r){if(r&&r.bizError)m.loginUser.parent().addClass("current"),v.userError.html(r.statusInfo),p.user=0;else v.userError.html(h),p.user=1}),a.on("success",function(r){if(r&&r.bizError)m.loginPhone.parent().addClass("current"),v.phoneError.html(r.statusInfo),p.pwd=0;else v.phoneError.html(h),p.pwd=1}),c.on("success",function(r){if(r&&r.bizError)m.loginTuiJian.parent().addClass("current"),v.tuiJianError.html(r.statusInfo),p.tui=0;else v.tuiJianError.html(h),p.tui=1}),u.on("success",function(e){var n=60;if(e&&e.bizError)alert(e.statusInfo);else{var i=t("#testing-wait");i.text("300秒后重新发送"),i.addClass("show"),r=setInterval(function(){if(i.text(--n+"秒后重新发送"),0>n)clearInterval(r),i.removeClass("show")},1e3)}}),f.on("success",function(r){if(r&&r.bizError)m.loginTest.parent().addClass("current"),v.testError.html(r.statusInfo),p.test=0;else v.testError.html(h),p.test=1}),g.on("success",function(r){if(r&&r.bizError)alert(r.statusInfo);else window.location.href="/account/overview/index"})}var t=require("jquery"),i=require("../common/picScroll"),o=require("common/header"),s=require("common/Remoter"),l=new s("REGIST_CHECKNAME_CHECK"),a=new s("REGIST_CHECKPHONE_CHECK"),u=new s("REGIST_SENDSMSCODE_CHECK"),c=new s("REGIST_CHECKINVITER_CHECK"),f=new s("REGIST_CHECKSMSCODE_CHECK"),g=new s("REGIST_INDEX_CHECK"),d=/^[a-zA-Z0-9!@#$%^&'\(\({}=+\-]{6,20}$/,h='<span class="username-error-span"></span>',m={loginUser:t("#regist-user"),loginPwd:t("#regist-pwd"),loginPhone:t("#regist-phone"),loginTest:t("#regist-testing"),loginTuiJian:t("#regist-tuijian")},v={userError:t("#regist-user-error"),phoneError:t("#regist-phone-error"),pwdError:t("#regist-pwd-error"),testError:t("#regist-testing-error"),tuiJianError:t("#regist-tuijian-error")},p={user:0,phone:0,pwd:0,test:0,tui:1},E={user:"loginUser",phone:"loginPhone",pwd:"loginPwd",test:"loginTest",tui:"loginTuiJian"};return{init:r}});