define("setting/phone/index",function(require){function e(){t(),a.compile(l),c.init()}function t(){{var e=n("#checkphone");n("#login-phonenew")}e.delegate(".login-input","focus",function(){var e=n(this).parent();n(this).next().addClass("hidden"),e.removeClass("current"),n("#login-phonenew-error").html(""),n("#username-error-error").html("")}),e.delegate(".login-input","blur",function(){var e=n.trim(n(this).val());!e&&n(this).next().removeClass("hidden")}),e.delegate("#sendsmscode","click",function(){var e=+n("#login-phonenew").val();if(!u.test(e))return void n(".error").html("手机号码格式不正确");if(e)n(".error").html(""),s.remote({phone:e,type:3})}),s.on("success",function(e){var t=n("#login-phonenew-error");if(e&&e.bizError)t.parent().addClass("current"),t.html(e.statusInfo);else{var i,r=60,o=n("#testing-wait");setInterval(function(){if(o.text("60秒后重新发送"),o.addClass("show"),o.text(--r+"秒后重新发送"),0>r)clearInterval(i),o.removeClass("show")},1e3)}}),e.delegate("#confirm","click",function(e){e.preventDefault();var t=n("#login-phonenew").val(),i=n("#login-test").val();if(!t||!i)return void n(".error").html("手机或验证码不能为空");else return void r.remote({oldPhone:t,vericode:i,type:3})}),r.on("success",function(e){if(e&&e.bizError)n(".error").html(e.statusInfo);else n("#checkphone").html(a.render("list2nd"))}),e.delegate("#confirm2nd","click",function(e){e.preventDefault();var t=n("#login-phonenew").val(),i=n("#login-test").val();if(!t||!i)return void n(".error").html("手机或验证码不能为空");else return void o.remote({newPhone:t,vericode:i,type:3})}),o.on("success",function(e){if(e&&e.bizError)alert(e.statusInfo);else{var t,i=8;n("#checkphone").html(a.render("list3th",{user:e})),t=setInterval(function(){if(n("#time-span").text(--i+"秒后自动跳转"),0===i)clearInterval(t),window.location.href="/account/views/overview/index"},1e3)}})}var n=require("jquery"),i=require("common/Remoter"),r=new i("EDIT_PHONE_SUBMITE"),o=new i("EDIT_PHONE_SUBMITE"),s=new i("REGIST_SENDSMSCODE_CHECK"),a=require("etpl"),l=require("./phone.tpl"),c=require("common/header"),u=/\d{11}/g;return{init:e}});