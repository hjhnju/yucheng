/*! 2014 Baidu Inc. All Rights Reserved */
define("my/invest/index",["require","jquery","etpl","moment","common/data","common/header","common/ui/Pager/Pager","common/Remoter","./list.tpl"],function(require){function e(){a=l("#my-invest-list"),f.init(),u.compile(w),g.remote({page:1}),n(),r()}function r(){l(".my-invest-tab-item").click(function(){if(!l(this).hasClass("current"))l(".my-invest-tab-item").removeClass("current"),l(this).addClass("current"),I=+l.trim(l(this).attr("data-value")),t(1)}),l(".my-invest-list").delegate(".view-plan-btn","click",function(){var e=l(".my-invest-item");if(l(this).hasClass("current"))return e.removeClass("current"),void l(this).removeClass("current");var r=l.trim(l(this).attr("data-id"));if(b=l(this),e.removeClass("current"),l(".view-plan-btn").removeClass("current"),l(this).closest(".my-invest-item").addClass("current"),l(this).addClass("current"),!l(this).hasClass("hasDetail"))v.remote({id:r})})}function n(){g.on("success",function(e){if(e.bizError)o(e);else{if(!s)s=new d(l.extend({},m.pagerOpt,{main:l("#my-invest-pager"),total:+e.pageall})),s.render(+e.page),s.on("change",function(e){t(e.value)});i("returnMoneyList",e)}}),g.on("fail",function(e){o(e)}),v.on("success",function(e){var r=l(b).closest(".my-invest-item").addClass("current").find(".my-invest-detail");if(e.bizError)r.render(u.render("Error",{msg:e.statusInfo}));else{if(!b)return;l(b).addClass("hasDetail");for(var n=0,t=e.list.length;t>n;n++)e.list[n].timeInfo=c.unix(e.list[n].time).format(y);r.html(u.render("returnMoneyDetail",{data:e}))}}),p.on("success",function(e){if(e.bizError)o(e);else i("tenderingList",e)}),p.on("fail",function(e){o(e)}),E.on("success",function(e){if(e.bizError)o(e);else i("endedList",e)}),E.on("fail",function(e){o(e)}),C.on("success",function(e){if(e.bizError)o(e);else i("tenderFailList",e)}),C.on("fail",function(e){o(e)})}function t(e){switch(a.html(u.render("Loading")),l("#my-invest-pager").html(""),I){case 1:g.remote({page:e});break;case 2:p.remote({page:e});break;case 3:E.remote({page:e});break;case 4:C.remote({page:e})}}function i(e,r){s.setOpt("pageall",+r.pageall),s.render(+r.page);for(var n=0,t=r.list.length;t>n;n++)if(r.list[n].timeInfo=c.unix(r.list[n].tenderTime).format("YYYY-MM-DD hh:mm"),r.list[n].endTime)r.list[n].endTimeInfo=c.unix(r.list[n].endTime).format(y);a.html(u.render(e,{list:r.list}))}function o(e){a.render(u.render("Error",{msg:e.statusInfo}))}var s,a,l=require("jquery"),u=require("etpl"),c=require("moment"),m=require("common/data"),f=require("common/header"),d=require("common/ui/Pager/Pager"),h=require("common/Remoter"),g=new h("MY_INVEST_GET"),v=new h("MY_INVEST_DETAIL"),p=new h("MY_INVEST_TENDERING"),E=new h("MY_INVEST_ENDED"),C=new h("MY_INVEST_TENDERFAIL"),w=require("./list.tpl"),I=1,b=null,y="YYYY-MM-DD";return{init:e}});